{% extends "base_generic.html" %}
{% load static %}

{% block title %}Animation{% endblock %}

{% block styles %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/visualisation.css' %}">
{% endblock %}

{% block content %}
    <div class="plot-container">
        <div id="animation-title">
            visualisation
        </div>
        <div id="animation-holder">
            <img id="animation" alt="Animation pending ..." />
        </div>
    </div>
    <div class="inputs-holder">
        <input type="text" id="session-id-input" placeholder="session id ..." onfocus="this.placeholder=''" onblur="this.placeholder='session id...'">
        <input type="text" id="clip-num-input" placeholder="clip number ..." onfocus="this.placeholder=''" onblur="this.placeholder='clip number ...'">
        <button id="start-visualisation-button">START</button>
    </div>
{% endblock %}


{% block scripts %}
    {{ block.super }}
    <script type="module" src="{% static 'js/visualisation.js' %}"></script>
    <script>
        const frameData = JSON.parse('{{ frames|safe }}');
        let currentFrame = 0;

        function updateFrame() {
            const base64Img = frameData[currentFrame];
            if (!base64Img) {
                console.error('Invalid base64 image data:', base64Img);
                console.error('Current frame:', currentFrame);
                console.error('Frame data:', frameData);
                return;
            }

            const img = document.getElementById("animation");
            img.src = "data:image/png;base64," + base64Img;

            currentFrame++;
            if (currentFrame >= frameData.length) {
                currentFrame = 0;
            }
        }

        setInterval(updateFrame, 100);  // Adjust the interval (in milliseconds) to control the animation speed
    </script>
{% endblock %}
